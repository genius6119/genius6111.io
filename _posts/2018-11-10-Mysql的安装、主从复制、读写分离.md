---
layout:     post
title:      Mysql的安装、主从复制、读写分离
subtitle:   ——SpringBoot2.1.1+Mysql5.7.22+CentOS7.4
date:       2018-11-13
author:     Zwx
header-img: img/post-bg-rwd.jpg
catalog: true
tags:
    - SpringBoot
    - Sql
    - Linux
---

---
## 前言
　　　最近在学习高可用性系统的相关知识，上周配置了简单的nginx负载均衡，缓解了应用服务器的压力，但是多个应用服务器用的还是同一个数据库，这样会使数据库的压力增大，效率变低。
而优化数据库，除了加硬件、sql语句优化和索引之外，就是多数据源了。这里我记录一下mysql多数据源的配置：
一个主库一个从库，写(增删)操作写入主库，从库同步主库的内容，读(改查)操作从从库读。

---
## 安装Mysql
　　在一个linux系统上安装mysql其实挺麻烦的，有钱的话直接买阿里云的RDS，一步到位。这里记录一下用rpm包从头安装的步骤吧。

- 在[Mysql官网](https://dev.mysql.com/downloads/mysql/5.7.html#downloads)下载Mysql，用xftp工具传到linux服务器上。

![](http://pic.zwxzzz.top/downmysql.png)

- Centos7有自带的mariadb数据库，和Mysql的包有冲突，需要先找到并删除。
```
[root@VM_0_9_redhat ~]# rpm -qa | grep -i mariadb
mariadb-libs-5.5.52-1.el7.x86_64
[root@VM_0_9_redhat ~]# rpm -e --nodeps mariadb-libs-5.5.52-1.el7.x86_64
```
- 解压
```
[root@VM_0_9_redhat ~]# cd /opt/mysql/
[root@VM_0_9_redhat mysql]# tar -xvf mysql-5.7.22-1.el7.x86_64.rpm-bundle.tar 
mysql-community-libs-5.7.22-1.el7.x86_64.rpm
mysql-community-libs-compat-5.7.22-1.el7.x86_64.rpm
mysql-community-embedded-5.7.22-1.el7.x86_64.rpm
mysql-community-test-5.7.22-1.el7.x86_64.rpm
mysql-community-server-5.7.22-1.el7.x86_64.rpm
mysql-community-client-5.7.22-1.el7.x86_64.rpm
mysql-community-server-minimal-5.7.22-1.el7.x86_64.rpm
mysql-community-devel-5.7.22-1.el7.x86_64.rpm
mysql-community-common-5.7.22-1.el7.x86_64.rpm
mysql-community-minimal-debuginfo-5.7.22-1.el7.x86_64.rpm
mysql-community-embedded-devel-5.7.22-1.el7.x86_64.rpm
mysql-community-embedded-compat-5.7.22-1.el7.x86_64.rpm
[root@VM_0_9_redhat mysql]# 
```
- 依次执行这四个包,因为有依赖，顺序不能乱：
```
rpm -ivh mysql-community-common-5.7.22-1.el7.x86_64.rpm
rpm -ivh mysql-community-libs-5.7.22-1.el7.x86_64.rpm
rpm -ivh mysql-community-client-5.7.22-1.el7.x86_64.rpm
rpm -ivh mysql-community-server-5.7.22-1.el7.x86_64.rpm
```
- 执行`rpm -ivh mysql-community-server-5.7.22-1.el7.x86_64.rpm`时有可能会有报错缺某某依赖,缺什么装什么即可解决,解决方法：`yum  install    numactl`：
```
[root@VM_0_9_redhat mysql]# rpm -ivh mysql-community-server-5.7.22-1.el7.x86_64.rpm
warning: mysql-community-server-5.7.22-1.el7.x86_64.rpm: Header V3 DSA/SHA1 Signature, key ID 5072e1f5: NOKEY
error: Failed dependencies:
	libnuma.so.1()(64bit) is needed by mysql-community-server-5.7.22-1.el7.x86_64
	libnuma.so.1(libnuma_1.1)(64bit) is needed by mysql-community-server-5.7.22-1.el7.x86_64
	libnuma.so.1(libnuma_1.2)(64bit) is needed by mysql-community-server-5.7.22-1.el7.x86_64
[root@VM_0_9_redhat mysql]# yum  install    numactl
```
- 初始化：输入`mysqld --initialize`命令，执行之后会在`/var/log/mysqld.log`中生成root的密码：
```
2018-11-12T03:39:37.749332Z 0 [Warning] TIMESTAMP with implicit DEFAULT value is deprecated. Please use --explicit_defaults_for_timestamp server option (see documentation for more details).
2018-11-12T03:39:46.650203Z 0 [Warning] InnoDB: New log files created, LSN=45790
2018-11-12T03:39:48.338301Z 0 [Warning] InnoDB: Creating foreign key constraint system tables.
2018-11-12T03:39:48.713622Z 0 [Warning] No existing UUID has been found, so we assume that this is the first time that this server has been started. Generating a new UUID: 9aef7d68-e62c-11e8-8e88-52540032b1e8.
2018-11-12T03:39:48.725846Z 0 [Warning] Gtid table is not ready to be used. Table 'mysql.gtid_executed' cannot be opened.
2018-11-12T03:39:48.726528Z 1 [Note] A temporary password is generated for root@localhost: FTp,(t;o_6fR
``` 
最后一行的`FTp,(t;o_6fR`就是密码。

-登陆：`mysql -uroot -p`，回车后输入密码，use mysql后他会提示你修改密码，按照提示修改密码即可：
```
mysql> use mysql;
ERROR 1820 (HY000): You must reset your password using ALTER USER statement before executing this statement.
mysql> ALTER USER 'root'@'localhost' IDENTIFIED BY 'root';
Query OK, 0 rows affected (0.00 sec)
```
- 用navicat远程连接测试，如果连不上赋予一下权限就好i，这里用的root账号，就不用赋予权限了。

---
## 主从复制













